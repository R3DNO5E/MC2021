# Linuxシステムプログラミング入門 事前学習#4.5 dupシステムコールの使い方
ここでは，`dup`システムコールの使い方について説明します．
## プロトタイプ
ライブラリ関数のプロトタイプは以下のようになっています．
```c
int dup(int oldfd);
int dup2(int oldfd, int newfd);
```
## 動作
`dup`システムコールは，ファイルディスクリプタを複製します．あるファイルディスクリプタを使ってあるファイルにアクセスできるとき，このシステムコールを使ってファイルディスクリプタを複製すると，新しいファイルディスクリプタを使ってそのファイルにアクセスできるようになります．
### オフセット
ファイルの参照位置(オフセット)など，そのファイルの情報は共有されます．
### 閉じるとき
複製したファイルディスクリプタまたは元になったファイルディスクリプタを閉じても，もう片方のファイルディスクリプタには影響しません．
## 引数
`dup`の引数は複製元のファイルディスクリプタです．
`dup2`の第一引数は複製元のファイルディスクリプタで，第二引数は新しいファイルディスクリプタです．第二引数として指定した番号が新しいファイルディスクリプタになります．
## 返り値
成功した場合，新しいファイルディスクリプタです．失敗した場合，`-1`が返ります．
## 代表的な使用方法
標準出力のファイルディスクリプタを複製するには以下のように記述します．
```c
int fd = dup(STDOUT_FILENO);
```
`123`というファイルディスクリプタで標準出力に書き込めるようにするには以下のように記述します．
```c
dup2(STDOUT_FILENO,123);
```
## 例
複製したファイルディスクリプタを利用して標準出力に書き込みます．
```c
#include <unistd.h>

int main(){
    if(dup2(STDOUT_FILENO,123) == -1){
        puts("dup2 failed!\n");
    }
    write(123,"Hello\n",6);
}
```
